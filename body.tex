\section{Introduction}

\section{Related Work}

\section{Background}

\subsection{Evolution of Censorship Techniques}
In parallel with the continuous expansion of internet users, diverse web services and social media apps that have become integral to modern life, censorship techniques are also actively evolving by world governments. 

As a response, the anti-censorship community is committed to developing and distributing circumvention tools for accessing the unrestricted Internet. Consequently, governments have shifted from simple and cost-effective approaches to more complex, expensive, and harder-to-circumvent censorship techniques.

These methods vary from simple DNS poisoning to advanced technologies like Deep Packet Inspection (DPI), allowing them to make decisions on a per-connection basis. In extreme cases, certain countries are even willing to pay astronomical prices, resorting to complete internet shutdowns.

Some countries have taken further steps by developing tools to weaponize innocent users, turning them into botnets used for attacking and disrupting popular VPN service providers. China's Great Canyon is a specific example, where malicious JavaScript payloads are sent to users to perform DDoS attacks on targeted websites.\cite{marczak2015great}

\subsection{From Centralized to Distributed Censorship Control}
Given the decentralized structure of the Internet, it is impractical to route the entire traffic of a country through a single device or a cluster of censoring devices. Instead, each Internet Service Provider (ISP) is responsible for implementing censorship individually, ideally at the network edge. The management of these middleboxes can be established either centrally, directly by authorities, or individually by each ISP, depending on their respective policies.

In some countries, like Russia, a centralized control model is implemented, where the authority maintains control over a network of numerous Internet Service Providers (ISPs). This centralized approach grants substantial power to the authorities, allowing them to unilaterally impose desired restrictions. In contrast, countries such as Iran follow a distributed model, resulting in potential inconsistencies in censorship behavior among different ISPs, leading to varied experiences for users.\cite{xue2021throttling}

In India, the authorities shared that while the censorship policies are confidential, the onus of implementing them lies with the individual ASes who could employ any mechanism they choose.\cite{yadav2018light}

While a centralized approach may offer a faster response and the ability to swiftly implement blocks, distributed control could prove more resilient in combating constantly updated circumvention tools. This is because circumvention tools must take into account the diverse policies and technologies employed by different ISPs in a distributed model.

\subsection{Stateful Censorship}
To examine the application-layer content with DPI, a censorship system like the GFW needs to keep some state to track each TCP connection. In particular, it maintains a TCP Control Block (TCB) for each live connection to track its state information (e.g., TCP state, sequence number, acknowledgment number, etc.). The goal is to replicate the same connection information at both endpoints. \cite{wang2017state}

While not all censorship techniques necessitate maintaining state, stateful censorship, despite its costliness, offers significant flexibility and advanced analysis capabilities. However, using specially crafted packets makes it possible to desynchronize the state on the DPI and evade the censor without disrupting the client or the server.

\subsection{Circumvention Technologies}
In the early phases of internet censorship, blocking mostly took place at the routing layer, utilizing IP blacklists and whitelists to limit access to particular IP addresses/ranges. However, users quickly discovered they could leverage the network as a simple proxy service, leveraging multiple access points to evade basic IP/Port blocking. These techniques involved encapsulating packets within another packet and requesting a proxy server to transmit the inner packet to the intended destination and vice versa.

The advent of Deep Packet Inspection (DPI) systems with content-based filtering capabilities rendered the previous approach ineffective. However, users soon discovered that encrypting packets became a valuable solution as the DPI could no longer comprehend the content within.

Various protocols such as Tor found success at that time. However, Tor’s biggest weakness in this respect is its global public list of relays where a censor can simply download and add each IP address to a blacklist - and censors began to do exactly that. In response to blocking its relays, Tor began to carefully distribute bridges through rate-limited out-of-band channels (such as email or HTTP). This makes it possible for everyone to learn a few bridge addresses while making it hard for anyone to learn them all.

Even using secret bridge relays, Tor remains vulnerable to detection by deep packet inspection (DPI). Tor uses TLS in a fairly distinctive way that causes it to stand out from other TLS-based protocols. After early efforts to make their use of TLS less conspicuous, the developers of Tor settled on a more sustainable strategy: wrapping the entire Tor TLS stream in another layer—a “pluggable transport” and shortly after, transport protocols Obfs2, Obfs3, and Obfs4 were introduced.\cite{ensafi2015firewall}

\section{Mechanics of Real-time Censorship in GFW}

\subsection{Protocol Fingerprinting}
Every internet protocol has its distinct characteristics that differentiates it from other protocols. This knowledge enables censors to recognize circumvention traffic by detecting these unique fingerprints. Censors develop regular expressions specifically designed to identify indicators of permissible traffic, allowing them to quickly exempt such traffic from censorship and classify it as allowed.

For instance, in 2012, China and Ethiopia deployed deep packet inspection to detect Tor traffic by its uncommon ciphersuits. Censorship middlebox vendors have previously identified and blocked meek traffic based on their TLS fingerprint and SNI values.\cite{wu2023great}

Before the implementation of the new censorship system by the GFW, fully encrypted traffic was generally treated as regular traffic, likely because the GFW was cautious about the potential collateral damage caused by mistakenly blocking legitimate traffic. This conservative approach might have reflected the GFW's uncertainty in having collected fingerprints for all the allowed protocols.

With the implementation of the new censorship system, the effectiveness of fully encrypted tunnels came into question. Even though an encrypted tunnel leaks no information about the payload or its final destination, it still requires effort to perfectly align its fingerprints with popular protocols that form the majority of traffic to avoid blocking.

An important characteristic of fully encrypted traffic that differentiates it from other traffic is its high entropy homogeneously throughout the entire connection, even in the first data packet. Because fully encrypted traffic is supposed to be purely random, it will have close to half of the bits set to 1. This is in contrast to other protocols with fewer than 1 bits per byte due to plaintext or zero-padded protocol headers.\cite{wu2023great}

\subsection{Flow Reassembly}
It is observed that a complete TCP handshake is necessary to trigger the real-time censor. Also, the GFW only examines the first data packet for now. Moreover, it is shown that the GFW waits more than 5 minutes for the first data packet. However, it is worth mentioning that only client-to-server packets can trigger the blocking; The server here is defined as the host that sends a SYN+ACK during the TCP handshake.\cite{wu2023great}

A potential approach to bypass real-time censorship would involve sending the first packet in a way that convinces the censor it is part of an allowed traffic flow while sending circumvention traffic in the subsequent packets. The server would be expected to disregard the first packet accordingly. However, the censor could easily change its behavior to check packets other than the first one with the help of its stateful nature.

The evasion strategy must ensure that there are no conspicuous fingerprints that would indicate the presence of forbidden traffic to the censor.

\subsection{How the GFW Disrupts a Connection}

\subsection{Residual Censorship}

\section{Evading Real-time Censorship}

\subsection{Detecting Exemption Rules}

\subsection{Discovering Rules}

\subsection{Evaluating Discovered Rules}

\subsection{Circumvention Strategies}

\section{Combining Multiple Censoring Techniques}

\subsection{The Role of Active Prober}

\section{Locating Network Middleboxes}

\section{Conclusion}

\section{Summary}